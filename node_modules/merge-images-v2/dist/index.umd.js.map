{"version":3,"file":"index.umd.js","sources":["../src/index.js"],"sourcesContent":["/* eslint new-cap: [\"error\", { \"properties\": false }] */\n\n// Defaults\nconst defaultOptions = {\n\tformat: 'image/png',\n\tquality: 0.92,\n\twidth: undefined,\n\theight: undefined,\n\tCanvas: undefined\n};\n\nconst createCanvas = options =>\n\toptions.Canvas ?\n\t\tnew options.Canvas.Canvas() :\n\t\twindow.document.createElement('canvas');\n\nconst createImage = options =>\n\toptions.Canvas ?\n\t\toptions.Canvas.Image :\n\t\twindow.Image;\n\n// Return Promise\nconst mergeImages = (sources = [], options = {}) => new Promise(resolve => {\n\toptions = Object.assign({}, defaultOptions, options);\n\n\t// Setup browser/Node.js specific variables\n\tconst canvas = createCanvas(options);\n\tconst Image = createImage(options);\n\tif (options.Canvas) {\n\t\toptions.quality *= 100;\n\t}\n\n\t// Load sources\n\tconst images = sources.map(source => new Promise((resolve, reject) => {\n\t\t// Convert sources to objects\n\t\tif (source.constructor.name !== 'Object') {\n\t\t\tsource = { src: source };\n\t\t}\n\n    if (source.width && source.height) {\n      const img = new Image(source.width, source.height);\n\n      img.onerror = () => reject(new Error('Couldn\\'t load image'));\n      img.onload = () => {\n        const { width, height } = source;\n        const canvas = createCanvas(options);\n        const ctx = canvas.getContext('2d');\n\n        canvas.width = width;\n        canvas.height = height;\n        ctx.drawImage(img, 0, 0, width, height);\n\n        // Adjust source image width and height\n        const resizeImg = new Image();\n        resizeImg.onerror = () => reject(new Error('Couldn\\'t load image'));\n        resizeImg.onload = () => resolve(Object.assign({}, source, { img: resizeImg }));\n        resizeImg.src = canvas.toDataURL();\n      };\n      img.src = source.src;\n    } else {\n      // Resolve source and img when loaded\n      const img = new Image();\n      img.onerror = () => reject(new Error('Couldn\\'t load image'));\n      img.onload = () => resolve(Object.assign({}, source, { img }));\n      img.src = source.src;\n    }\n\t}));\n\n\t// Get canvas context\n\tconst ctx = canvas.getContext('2d');\n\n\t// When sources have loaded\n\tresolve(Promise.all(images)\n\t\t.then(images => {\n\t\t\t// Set canvas dimensions\n\t\t\tconst getSize = dim => options[dim] || Math.max(...images.map(image => image.img[dim]));\n\t\t\tcanvas.width = getSize('width');\n\t\t\tcanvas.height = getSize('height');\n\n\t\t\t// Draw images to canvas\n\t\t\timages.forEach(image => {\n\t\t\t\tctx.globalAlpha = image.opacity ? image.opacity : 1;\n\t\t\t\treturn ctx.drawImage(image.img, image.x || 0, image.y || 0);\n\t\t\t});\n\n\t\t\tif (options.Canvas && options.format === 'image/jpeg') {\n\t\t\t\t// Resolve data URI for node-canvas jpeg async\n\t\t\t\treturn new Promise(resolve => {\n\t\t\t\t\tcanvas.toDataURL(options.format, {\n\t\t\t\t\t\tquality: options.quality,\n\t\t\t\t\t\tprogressive: false\n\t\t\t\t\t}, (err, jpeg) => {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tthrow err;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(jpeg);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Resolve all other data URIs sync\n\t\t\treturn canvas.toDataURL(options.format, options.quality);\n\t\t}));\n});\n\nexport default mergeImages;\n"],"names":["const","img"],"mappings":";;;;;;CAAA;;;CAGAA,IAAM,cAAc,GAAG;EACtB,MAAM,EAAE,WAAW;EACnB,OAAO,EAAE,IAAI;EACb,KAAK,EAAE,SAAS;EAChB,MAAM,EAAE,SAAS;EACjB,MAAM,EAAE,SAAS;EACjB,CAAC;;CAEFA,IAAM,YAAY,aAAG,SAAQ,SAC5B,OAAO,CAAC,MAAM;GACb,IAAI,OAAO,CAAC,MAAM,CAAC,MAAM,EAAE;GAC3B,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,QAAQ,IAAC,CAAC;;CAE1CA,IAAM,WAAW,aAAG,SAAQ,SAC3B,OAAO,CAAC,MAAM;GACb,OAAO,CAAC,MAAM,CAAC,KAAK;GACpB,MAAM,CAAC,QAAK,CAAC;;;CAGfA,IAAM,WAAW,aAAI,OAAY,EAAE,OAAY,EAAE;mCAArB,GAAG;mCAAW,GAAG;;SAAO,IAAI,OAAO,WAAC,SAAQ;EACvE,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,cAAc,EAAE,OAAO,CAAC,CAAC;;;EAGrDA,IAAM,MAAM,GAAG,YAAY,CAAC,OAAO,CAAC,CAAC;EACrCA,IAAM,KAAK,GAAG,WAAW,CAAC,OAAO,CAAC,CAAC;EACnC,IAAI,OAAO,CAAC,MAAM,EAAE;GACnB,OAAO,CAAC,OAAO,IAAI,GAAG,CAAC;GACvB;;;EAGDA,IAAM,MAAM,GAAG,OAAO,CAAC,GAAG,WAAC,QAAO,SAAG,IAAI,OAAO,WAAE,OAAO,EAAE,MAAM,EAAE;;GAElE,IAAI,MAAM,CAAC,WAAW,CAAC,IAAI,KAAK,QAAQ,EAAE;IACzC,MAAM,GAAG,EAAE,GAAG,EAAE,MAAM,EAAE,CAAC;IACzB;;KAEC,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,MAAM,EAAE;OACjCA,IAAM,GAAG,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC;;OAEnD,GAAG,CAAC,OAAO,eAAM,SAAG,MAAM,CAAC,IAAI,KAAK,CAAC,sBAAsB,CAAC,IAAC,CAAC;OAC9D,GAAG,CAAC,MAAM,eAAM;SACd;SAAe,2BAAkB;SACjCA,IAAM,MAAM,GAAG,YAAY,CAAC,OAAO,CAAC,CAAC;SACrCA,IAAM,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;;SAEpC,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC;SACrB,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC;SACvB,GAAG,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;;;SAGxCA,IAAM,SAAS,GAAG,IAAI,KAAK,EAAE,CAAC;SAC9B,SAAS,CAAC,OAAO,eAAM,SAAG,MAAM,CAAC,IAAI,KAAK,CAAC,sBAAsB,CAAC,IAAC,CAAC;SACpE,SAAS,CAAC,MAAM,eAAM,SAAG,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,EAAE,EAAE,GAAG,EAAE,SAAS,EAAE,CAAC,IAAC,CAAC;SAChF,SAAS,CAAC,GAAG,GAAG,MAAM,CAAC,SAAS,EAAE,CAAC;QACpC,CAAC;OACF,GAAG,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC;MACtB,MAAM;;OAELA,IAAMC,KAAG,GAAG,IAAI,KAAK,EAAE,CAAC;OACxBA,KAAG,CAAC,OAAO,eAAM,SAAG,MAAM,CAAC,IAAI,KAAK,CAAC,sBAAsB,CAAC,IAAC,CAAC;OAC9DA,KAAG,CAAC,MAAM,eAAM,SAAG,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,EAAE,OAAEA,KAAG,EAAE,CAAC,IAAC,CAAC;OAC/DA,KAAG,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC;MACtB;GACH,IAAC,CAAC,CAAC;;;EAGJD,IAAM,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;;;EAGpC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC;IACzB,IAAI,WAAC,QAAO;;IAEZA,IAAM,OAAO,aAAG,KAAI,SAAG,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,SAAG,CAAC,MAAG,MAAM,CAAC,GAAG,WAAC,OAAM,SAAG,KAAK,CAAC,GAAG,CAAC,GAAG,IAAC,CAAC,IAAC,CAAC;IACxF,MAAM,CAAC,KAAK,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC;IAChC,MAAM,CAAC,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;;;IAGlC,MAAM,CAAC,OAAO,WAAC,OAAM;KACpB,GAAG,CAAC,WAAW,GAAG,KAAK,CAAC,OAAO,GAAG,KAAK,CAAC,OAAO,GAAG,CAAC,CAAC;KACpD,OAAO,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;KAC5D,CAAC,CAAC;;IAEH,IAAI,OAAO,CAAC,MAAM,IAAI,OAAO,CAAC,MAAM,KAAK,YAAY,EAAE;;KAEtD,OAAO,IAAI,OAAO,WAAC,SAAQ;MAC1B,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,EAAE;OAChC,OAAO,EAAE,OAAO,CAAC,OAAO;OACxB,WAAW,EAAE,KAAK;OAClB,YAAG,GAAG,EAAE,IAAI,EAAE;OACd,IAAI,GAAG,EAAE;QACR,MAAM,GAAG,CAAC;QACV;OACD,OAAO,CAAC,IAAI,CAAC,CAAC;OACd,CAAC,CAAC;MACH,CAAC,CAAC;KACH;;;IAGD,OAAO,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC;IACzD,CAAC,CAAC,CAAC;EACL;EAAC,CAAC;;;;;;;;"}